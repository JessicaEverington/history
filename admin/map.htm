<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<title>Slippy map</title>
		<link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.6.4/leaflet.css" />
		<link rel="stylesheet" href="../css/map.css">
	</head>
	<body>
		<div id="controls"><button id="next">Next pin</button><button id="prev">Prev pin</button><button id="three">Third pin</button></div>
		<div id="mapBox"></div>
		<!-- Attach Leaflet & Mapstraction -->
		<script src="http://cdn.leafletjs.com/leaflet-0.6.4/leaflet.js"></script>
		<script src="../lib/mxn-3.0.0-RC5/mxn.js"></script>
		<script src="../lib/mxn-3.0.0-RC5/mxn.core.js"></script>
		<script src="../lib/mxn-3.0.0-RC5/mxn.leaflet.core.js"></script>
		<!-- Attach jQuery library -->
		<script src="../lib/jquery/dist/jquery.min.js"></script>
		<!-- Attach XML and JSON converter library -->
		<script src="../lib/json_to_xml.js"></script>
		<!-- Attach global utilities -->
		<script src="../js/global.js"></script>
		<!-- Attach slippy map -->
		<script src="../js/map.js"></script>
		<!-- Attach XML utilities -->
		<script src="../js/xml.js"></script>
		<!-- Implementation -->
		<script>
			function displayAlbum(response) {
				$.each(response.json.album.photo, function (i, photo) {
					var addOptions = {};
					addOptions.html = "<div class='thumbPlaceholder'><img src='" + map.util.filenamePath(photo.filename) + "'></div><div class='caption'>" + photo.thumb_caption + "</div>";
					addOptions.id = photo.filename || i;
					
					if (photo.geo) {
						addOptions.coordinates = [photo.geo.lon, photo.geo.lat];
					}
					
					map.pin.add(addOptions);
				});
				map.pin.next();
			}
			function bind() {
				$("#next").click(map.pin.next);
				$("#prev").click(map.pin.prev);
				$("#three").click(function () {
					map.pin.go(3);
				});
			}
			var map,
				meta = {
					"gallery": 'demo',
					"album": 'sample'
				},
				xml;
			map = new Map({
				"album": meta.album,
				"gallery": meta.gallery,
				"events": {
					"highlightPlottedPin": function () {
						jQuery("#mapBox").removeClass("subtle");
					},
					"highlightOmittedPin": function () {
						jQuery("#mapBox").addClass("subtle");	
					}
				},
				"map": {
					"centre": [0, 0],
					"containerId": 'mapBox',
					"zoom": 10
				}
			});
			xml = new Xml({"gallery": meta.gallery, "album": meta.album, "callback": displayAlbum});
			bind();
		</script>
	</body>
</html>